apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "dcs-order.fullname" . }}
  labels:
    app: {{ template "dcs-order.fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
data:
  application.properties: |-
    server.port= {{ .Values.servicePort | default "9001" }}
    grpc.server.port = {{ .Values.GrpcPort | default "50501" }}
    service.name = {{ .Values.serviceName }}
    stripe.apiKey = {{ .Values.apiKey }}

    auth.grpc.host = {{ .Values.auth.authGrpcHost }}
    auth.grpc.port = {{ .Values.auth.authGrpcPort }}
    auth.cookie.name = {{ .Values.auth.authCookieName }}
    auth.cookie.domain = {{ .Values.auth.authCookieDomain | default "" }}
    auth.login.path = {{ .Values.auth.authLoginPath | default "/login" }}
    auth.logout.path = {{ .Values.auth.authLogoutPath | default "/logout" }}
    auth.userinfo.path = {{ .Values.auth.authUserinfoPath | default "/userinfo" }}
    auth.logout.redirect.path = {{ .Values.auth.authLogoutRedirectPath }}

    grpc.client.gateway.host[0] = {{ .Values.services.paymentgatewayrServiceHost }}
    grpc.client.gateway.port[0] = {{ .Values.services.paymentgatewayGrpcPort }}

    spring.datasource.url = jdbc:mysql://{{ .Values.datasource.host }}:{{ .Values.datasource.port | default "3306" }}/{{ .Values.datasource.dbname | default "dcs_order_db" }}?{{ .Values.datasource.tinyInt1isBit | default "true" }}&{{ .Values.datasource.autoReconnect | default "true" }}&{{ .Values.datasource.autoReconnectForPools | default "false" }}&{{ .Values.datasource.useUnicode | default "true" }}&{{ .Values.datasource.characterEncoding | default "UTF-8" }}&{{ .Values.datasource.useSSL | default "false" }}
    spring.datasource.username = {{ .Values.datasource.username }}
    spring.datasource.password = {{ .Values.datasource.password }}
    spring.datasource.driver-class-name = com.mysql.jdbc.Driver
    spring.datasource.max-idle = 20
    spring.datasource.max-wait = 60000
    spring.datasource.min-idle = 5
    spring.datasource.initial-size = 5
    spring.datasource.validation-query = SELECT 1
    spring.datasource.test-on-borrow = true
    spring.datasource.test-while-idle = true
    spring.datasource.time-between-eviction-runs-millis = 18800
    spring.datasource.dbcp2.validation-query = select 1
    spring.jooq.sql-dialect = org.hibernate.dialect.MySQLDialect

    #show sql statement
    logging.level.org.hibernate.SQL = {{ .Values.sql.logging | default "Debug" }}
    spring.jpa.generate-ddl = false
