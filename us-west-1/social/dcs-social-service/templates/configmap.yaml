apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "dcs-social.fullname" . }}
  labels:
    app: {{ template "dcs-social.fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
data:
  service_conf.toml: |-
    title = "DCS SOCIAL service configurations"
    service_port = ":{{ .Values.servicePort  | default "8816" }}"
    log_level = {{ .Values.logLevel | default "Info" | quote }}

    region = {{ .Values.region | quote }}
    session_cookie_name = {{ .Values.sessionCookieName | quote }}
    session_cookie_domain = {{ .Values.sessionCookieDomain | default "" | quote }}

    login_path = {{ .Values.auth.loginPath | default "/login" | quote }}
    logout_path = {{ .Values.auth.logoutPath | default "/logout" | quote }}
    userinfo_path = {{ .Values.auth.userinfoPath | default "/userinfo" | quote }}
    logout_redirect_path = {{ .Values.auth.logoutRedirectPath | quote }}
    service_name = {{ .Values.auth.serviceName | default "social" | quote }}

    drive_service_endpoint = "http://{{ .Values.services.driveServiceHost }}:{{ .Values.services.driveServicePort }}"
    auth_service_endpoint    = "{{ .Values.services.authServiceHost }}:{{ .Values.services.authServicePort }}"
    
    [mongo_config]
        Address   = {{ .Values.mongo.address | quote }}
        Username  = {{ .Values.mongo.username | default "" | quote }}
        Password    = {{ .Values.mongo.password | default "" | quote }}
        Dbname  = {{ .Values.mongo.dbname | default "DCS_SOCIAL_DB" | quote }}

    [cache_config]
        Address = {{ .Values.redis.address | quote }}
        Password = {{ .Values.redis.password | quote }}
        DbNum = {{ .Values.redis.dbNum | default "9" }}
        IsCluster = {{ .Values.redis.isCluster }}
    
    [entity_type_mapping]
        ".jpg" = "image"
        ".jpeg" = "image"
        ".png" = "image"
        ".bmp" = "image"
        ".mp4" = "video"    